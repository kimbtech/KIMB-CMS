function show_error(a,b,c){$(c).html('<div class="ui-widget"><div class="ui-state-error ui-corner-all" style="padding: 5px;"><span class="ui-icon ui-icon-alert" style="float: left; margin-right: 6px;"></span><strong>'+a+"</strong>&nbsp;&nbsp;&nbsp;"+b+"</div></div>");return!0}
$(function(){var a;a='<div id="daten_loading"  style="display:none;"><div style="position:fixed; top:0; left:0; z-index:50; background-color:gray; opacity:0.5; width:100%; height:100%;"></div>';a+='<div style="position:fixed; top:calc( 50% - 64px ); left:calc( 50% - 64px ); background-color:#5d7; border-radius:20px; padding:15px; z-index:51;">';a+='<img src="'+add_daten.siteurl+'/load/system/spin_load.gif" title="L\u00e4dt!!" alt="L\u00e4dt!!">';a+="</div>";a+="</div>";$("body").append(a);$("#daten_loading").hide("highlight");
$(document).bind("ajaxSend",function(){$("#daten_loading").show("highlight")}).bind("ajaxComplete",function(){$("#daten_loading").hide("highlight")})});Dropzone.autoDiscover=!1;function j_alert(a,b){"undefined"===typeof b&&(b=300);$("div.j_alert").length&&$("div.j_alert").remove();var c;c='<div class="j_alert" title="Wichtig!!">'+a+"</div>";$("body").prepend(c);$("div.j_alert").dialog({modal:!0,width:b,responsive:!0,buttons:{OK:function(){$(this).dialog("close")}}})}$(function(){load_daten()});
var cssclass="div.addon_daten_main ";
function load_daten(){$(cssclass).html('<h2>Dateiverwaltung</h2><div id="firstbutt"><input type="radio" name="firstbutt" id="my" checked="checked"><label for="my">Mein Verzeichnis</label><input type="radio" name="firstbutt" id="pu"><label for="pu">F\u00fcr alle User</label><input type="radio" name="firstbutt" id="frei"><label for="frei">Freigaben</label></div><div class="main_files">Bitte w\u00e4hlen Sie einen Ort &uarr;</div>');$("div#firstbutt").buttonset();$("#firstbutt input[type=radio]").click(function(){set_vars($(this).attr("id"))});
set_vars("my")}var allgvars={};function set_vars(a){if("my"==a)allgvars.folder="user",allgvars.path="/",main_explorer();else if("pu"==a)allgvars.folder="public",allgvars.path="/",main_explorer();else if("frei"==a)show_freigaben();else return!1}
function main_explorer(){$.post(add_daten.siteurl+"/ajax.php?addon=daten",{allgvars:allgvars,todo:"filelist"}).always(function(a){var b='<div class="toolbar"><button id="add_table">Neue Tabelle</button><button id="add_file">Neue Datei</button><button id="add_folder">Neuer Ordner</button><br />',b=b+'<span class="input" style="display:none;"><input type="text" id="new_name" placeholder="Name"><small>Enter zum Speichern; Ctrl zum Abbrechen; Dateien gleichen Namens werden \u00fcberschrieben</small></span></div>',
b=b+('<div class="pathbar">'+allgvars.path+"</div>");a=a.main;var c=a.folder_ex;a=a.filelist;if(null!=a){var b=b+'<ul class="files">',d=0;$.each(a,function(a,c){b+='<li url="'+c.url+'" ftype="'+c.type+'" name="'+c.name+'"><span class="ui-icon ui-icon-'+("dir"==c.type?"folder-collapsed":"file"==c.type?"document":"kt"==c.type?"calculator":"blank")+'" style="display:inline-block;"></span>'+c.name+"</li>";d++});0==d&&(b+="<li>Der Ordner ist leer!</li>");b+="</ul>";b+="<small>Doppelklick auf Pfad zum Bearbeiten; Rechtsklick auf Datei oder Ordner zum L\u00f6schen</small>";
c?($("div.main_files").html(b),$("div.pathbar").unbind("dblclick").dblclick(function(){var a=$(this).html();-1===a.indexOf("<input")&&($(this).html('<input type="text" style="width:95%;" value="'+a+'">'),$(this).children("input").keyup(function(b){13==b.keyCode?(b=$(this).val(),$(this).parent().html(b),allgvars.path=b,main_explorer()):17==b.keyCode&&$(this).parent().html(a)}))}),$("ul.files li").unbind("click").click(function(){if(shall_do_fileload()){var a=$(this).attr("ftype"),b=$(this).attr("url"),
c=$(this).attr("name");"dir"==a?(allgvars.path=allgvars.path+b+"/",main_explorer()):"file"==a?open_file(b):"kt"==a&&open_table(b,c)}}),$("button#add_table").unbind("click").click(function(){$("div.toolbar span").css("display","inline");$("div.toolbar span input").unbind("keyup").keyup(function(a){13==a.keyCode?(a=$(this).val(),open_table(a+".kimb_table",a,!0),$("div.toolbar span").css("display","none")):17==a.keyCode&&$("div.toolbar span").css("display","none")})}),$("button#add_file").unbind("click").click(function(){var a;
a="<h2>Dateien hochladen</h2>"+('<form action="'+add_daten.siteurl+'/ajax.php?addon=daten" class="dropzone" id="dropzone">');a+='<input type="hidden" name="allgvars[folder]" value="'+allgvars.folder+'">';a+='<input type="hidden" name="allgvars[path]" value="'+allgvars.path+'">';a=a+'<input type="hidden" name="todo" value="uploadfile">'+('<img src="'+add_daten.siteurl+'/load/addondata/daten/upload.png" style="display: block; margin:auto;" title="Ziehen Sie zum Hochladen Dateien \u00fcber dieses Feld oder klicken Sie!" class="dz-message">');
a+="</form>";j_alert(a,600);(new Dropzone("form#dropzone")).on("queuecomplete",function(a){main_explorer()})}),$("button#add_folder").unbind("click").click(function(){$("div.toolbar span").css("display","inline");$("div.toolbar span input").unbind("keyup").keyup(function(a){13==a.keyCode?(a=$(this).val(),allgvars.file=a,$.post(add_daten.siteurl+"/ajax.php?addon=daten",{allgvars:allgvars,todo:"newfolder"}).always(function(a){null!=a&&null!=a.main&&a.main.wr?main_explorer():j_alert("Das Erstellen der Ordners ist fehlgeschlagen!")}),
$("div.toolbar span").css("display","none")):17==a.keyCode&&$("div.toolbar span").css("display","none")})}),$(document).on("contextmenu","ul.files li",function(a){var b=$(this).attr("name"),c=$(this).attr("url");a=$(this).attr("ftype");$("div.delfile_explorer").length&&$("div.delfile_explorer").remove();b='<div class="delfile_explorer" title="Dateieinstellungen">'+('M\u00f6chten Sie "'+b+'" l\u00f6schen?<br />')+'<span id="ja">Ja</span>';b+='<div class="delfile_explorer_satus" style="display:none;">Fehler</div>';
b+='<div class="frei" style="display:none;"><hr />';b+='Oder klicken Sie f\u00fcr eine Freigabe via Link auf "Freigeben"!<br />';b+='<span id="frei">Freigeben</span>';b+="</div></div>";$("body").prepend(b);$("div.delfile_explorer").dialog({modal:!0,responsive:!0,buttons:{Abbrechen:function(){$(this).dialog("close")}}});"file"!=a&&"kt"!=a||"user"!=allgvars.folder||$("div.delfile_explorer div.frei").css("display","block");$("div.delfile_explorer span").button();$("div.delfile_explorer span#ja").click(function(){allgvars.file=
c;$("div.delfile_explorer_satus").css({display:"none"});$.post(add_daten.siteurl+"/ajax.php?addon=daten",{allgvars:allgvars,todo:"delfile"}).always(function(a){null!=a&&null!=a.main&&a.main.wr?(main_explorer(),$("div.delfile_explorer").dialog("close")):$("div.delfile_explorer_satus").css({display:"block","background-color":"red",padding:"5px","border-radius":"2px",color:"white"})})});$("div.delfile_explorer div span#frei").click(function(){allgvars.file=c;make_freigabe();$("div.delfile_explorer").dialog("close")});
return!1})):show_error("404","Ordner nicht gefunden!","div.main_files")}else show_error("404","Ordner nicht gefunden!","div.main_files")})}var table_next_id,global_table_passw;
function open_table(a,b,c){"undefined"===typeof c&&(c=!1);allgvars.file=a;$("div.j_promt").length&&$("div.j_promt").remove();a='<div class="j_promt" title="Passwort ben\u00f6tigt!">Bitte geben Sie das Passwort f\u00fcr die Tabelle an!<br /><input type="password" placeholder="Passwort" id="js_table_passw"><br />';a+="<small>Lassen Sie das Feld f\u00fcr unverschl\u00fcsselte Tabellen leer.</small>";a+="</div>";$("body").prepend(a);$("div.j_promt").dialog({modal:!0,responsive:!0,buttons:{OK:function(){var a=
$("input#js_table_passw").val();global_table_passw=""!=a?a:"vqtxvpJJWiFJrNKcOQOjMgTHBxqGdiyuBhilfRktqfWLyHEw";$(this).dialog("close");open_table_get(b,c,!1)},"Passwort zeigen":function(){$("input#js_table_passw").attr("type","text")}}})}
function open_table_get(a,b,c){b?(c=!0,open_table_dialog(c,{table:[[0,"Name","Vorname"],[1,"Meier","Heinze"]],nextid:2},b,a)):$.post(add_daten.siteurl+"/ajax.php?addon=daten",{allgvars:allgvars,todo:"table"}).always(function(d){d=d.main;if(null!=d){d=JSON.parse(d);try{d=sjcl.decrypt(global_table_passw,d)}catch(g){j_alert('Die Tabelle konnte mit diesem Passwort nicht entschl\u00fcsselt werden!\r\n(Fehlermeldung:"'+g.message+'")');return}d=JSON.parse(d);c=!0}open_table_dialog(c,d,b,a)})}
function open_table_dialog(a,b,c,d){a?(table_next_id=b.nextid,b=b.table,make_table_html(b,"div.for_file_kimbta"),$("div.for_file_kimbta").css("display","block"),$("div.for_file_kimbta").dialog({width:720,modal:!0,responsive:!0,title:d,beforeClose:function(a,b){global_table_passw=""}}),c&&(save_new_table(b),main_explorer())):j_alert("Fehler beim Lesen der Tabelle")}
function open_file(a){a=add_daten.siteurl+"/ajax.php?addon=daten&folder="+encodeURI(allgvars.folder)+"&path="+encodeURI(allgvars.path+a);window.open(a,"_blank","width=900px,height=500px,top=20px,left=20px")}
function make_table_html(a,b){var c='<table width="100%" border="border">';$.each(a,function(a,b){c+="<tr>";0==a?$.each(b,function(b,e){c=0==b?c+('<th k="'+a+'" sk="'+b+'">'+e+"</th>"):c+('<th class="edit" k="'+a+'" sk="'+b+'">'+e+"</th>")}):$.each(b,function(b,e){c=0==b?c+('<td k="'+a+'" sk="'+b+'">'+e+"</td>"):c+('<td class="edit" k="'+a+'" sk="'+b+'">'+e+"</td>")});c+="</tr>"});c+="</table>";c+='<button id="new_sp">Spalte hinzuf\u00fcgen</button><br />';c+='<button id="new_ze">Zeile hinzuf\u00fcgen</button><br />';
c+="<small>Doppenklick zum \u00c4ndern; Alt zum Speichern; Ctrl zum Verwerfen; Rechtsklick zum L\u00f6schen/ Hinzuf\u00fcgen</small><br />";c+='<button id="exp_json">JSON Export</button>';c+='<button id="imp_json">JSON Import</button>';c+='<span class="add_daten_status" style="display:none;"></span>';$(b).html(c);$("div.for_file_kimbta table td.edit, div.for_file_kimbta table th.edit").unbind("dblclick").dblclick(function(){var b=$(this).attr("k"),c=$(this).attr("sk"),f=$(this).html();-1===f.indexOf('<textarea style="width:95%;">')&&
(f=f.replace(/<br \/>/g,"\r\n"),f=f.replace(/<br>/g,"\r\n"),$(this).html('<textarea style="width:95%;">'+f+"</textarea>"),$(this).children("textarea").keyup(function(e){18==e.keyCode?(e=$(this).val(),e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/\n/g,"<br />"),e=e.replace(/\r/g,"<br />"),e=e.replace(/\r\n/g,"<br />"),$(this).parent().html(e),a[b][c]=e,save_new_table(a)):17==e.keyCode&&$(this).parent().html(f)}))});$("button#new_sp").unbind("click").click(function(){new_spalte("end",
a,b)});$("button#new_ze").unbind("click").click(function(){new_reihe("end",a,b)});$("button#exp_json ").unbind("click").click(function(){make_json(a)});$("button#imp_json ").unbind("click").click(function(){import_json()});$(document).on("contextmenu","div.for_file_kimbta table td.edit",function(c){var g=$(this).attr("k"),f=$(this).attr("sk");$("div.rightclick_menue").length&&$("div.rightclick_menue").remove();c='<div class="rightclick_menue" title="Tabelle hier anpassen"><button id="sp_add">Spalte hier hinzuf\u00fcgen</button><br /><button id="ro_add">Reihe hier hinzuf\u00fcgen</button><br />';
c+="<small>Jeweils oberhalb bzw. links des angeklickten K\u00e4stchens</small><br/>";c+='<button id="sp_del">Spalte hier l\u00f6schen</button><br />';c+='<button id="ro_del">Reihe hier l\u00f6schen</button>';c+="</div>";$("body").prepend(c);$("div.rightclick_menue").dialog({modal:!0,responsive:!0});$("div.rightclick_menue button#sp_add").click(function(){new_spalte(f,a,b)});$("div.rightclick_menue button#ro_add").click(function(){new_reihe(g,a,b)});$("div.rightclick_menue button#sp_del").click(function(){del_spalte(f,
a,b)});$("div.rightclick_menue button#ro_del").click(function(){del_reihe(g,a,b)});return!1});return!0}function new_spalte(a,b,c){"end"!=a&&(a=parseInt(a));for(var d=0;d<b.length;d++)"end"==a?b[d].push("Wert"):b[d].splice(a,0,"Wert");make_table_html(b,c);save_new_table(b)}function new_reihe(a,b,c){var d=[];"end"!=a&&(a=parseInt(a));for(var g=0;g<b[0].length;g++)d.push("Wert");d[0]=table_next_id;table_next_id++;"end"==a?b.push(d):b.splice(a,0,d);make_table_html(b,c);save_new_table(b)}
function del_spalte(a,b,c){a=parseInt(a);for(var d=0;d<b.length;d++)b[d].splice(a,1);make_table_html(b,c);save_new_table(b)}function del_reihe(a,b,c){a=parseInt(a);b.splice(a,1);make_table_html(b,c);save_new_table(b)}function make_json(a){a=JSON.stringify({table:a,nextid:table_next_id});window.open("data:text/json;utf-8,"+a,"_blank","width=900px,height=500px,top=20px,left=20px,scrollbars=yes")}
function import_json(){$("div.import_json").length&&$("div.import_json").remove();var a;a='<div class="import_json" title="JSON in die Tabelle importieren">Bitte geben Sie hier den JSON Code f\u00fcr die Tabelle an:<br /><textarea id="json_impcode" placeholder=\'[[0,"Vorname","Name"],[1,"Max","Muster"],[2,"Maxa","Mustera"]]\' rows="5" cols="20"></textarea><br />';a+="<small>Der Import ersetzt die aktuelle Tabelle!</small>";a+='<span class="imp_daten_status" style="display:none;"></span>';a+="</div>";
$("body").prepend(a);$("div.import_json").dialog({modal:!0,responsive:!0,buttons:{"Import Data":function(){var a=$("textarea#json_impcode").val();try{var c=JSON.parse(a)}catch(d){$("span.imp_daten_status").html("Fehler"),$("span.imp_daten_status").css({display:"inline","background-color":"red",padding:"5px","border-radius":"2px",color:"white","float":"right"})}"object"===typeof c&&(table_next_id=c.nextid,c=c.table,make_table_html(c,"div.for_file_kimbta"),save_new_table(c),$("span.imp_daten_status").html("Importiert"),
$("span.imp_daten_status").css({display:"inline","background-color":"green",padding:"5px","border-radius":"2px",color:"white","float":"right"}),setTimeout(function(){$("div.import_json").dialog("close")},2E3))},Abbrechen:function(){$(this).dialog("close")}}})}
function save_new_table(a){$("span.add_daten_status").html("Speicherung ...");$("span.add_daten_status").css({display:"inline","background-color":"orange",padding:"5px","border-radius":"2px",color:"white","float":"right"});a={table:a,nextid:table_next_id};a=sjcl.encrypt(global_table_passw,JSON.stringify(a));$.post(add_daten.siteurl+"/ajax.php?addon=daten",{allgvars:allgvars,todo:"tablesave",data:JSON.stringify(a)}).done(function(a){a.main.wr?($("span.add_daten_status").html("Gespeichert"),$("span.add_daten_status").css({"background-color":"green"}),
setTimeout(function(){$("span.add_daten_status").css("display","none")},5E3)):($("span.add_daten_status").html("Fehler"),$("span.add_daten_status").css({"background-color":"red"}))}).fail(function(){$("span.add_daten_status").html("Fehler");$("span.add_daten_status").css({"background-color":"red"})})}
function make_freigabe(){$.post(add_daten.siteurl+"/ajax.php?addon=daten",{allgvars:allgvars,todo:"newfreigabe"}).always(function(a){a.main.okay?j_alert('Die Datei wurde freigegeben.<br /><br /><input readonly="readonly" onclick="this.focus();this.select();" style="border:1px solid black; background-color:gray; text:white; width:100%;" value="'+a.main.link+'"><br /><br />Unter "Freigabe" sehen Sie alle Freigaben und k\u00f6nnen diese l\u00f6schen!'):j_alert("Die Freigabe schlug fehl!")})}
function show_freigaben(){$.post(add_daten.siteurl+"/ajax.php?addon=daten",{todo:"freigabeliste"}).always(function(a){if(a.main.okay&&null!=a.main.list){var b='<ul class="freigaben">';$.each(a.main.list,function(a,d){b+='<li fid="'+d.id+'" path="'+d.path+'">';b+='<span class="ui-icon ui-icon-bullet" style="display:inline-block"></span>';b+='<span class="show_link" title="Link zur Datei anzeigen"><span class="ui-icon ui-icon-link" style="display:inline-block"></span></span>';b+='<a href="'+d.link+
'" target="_blank" title="Datei \u00fcber Freigabelink \u00f6ffnen"><span class="ui-icon ui-icon-extlink" style="display:inline-block"></span></a>';b+='<span class="del_link" title="Freigabe l\u00f6schen"><span class="ui-icon ui-icon-trash" style="display:inline-block"></span></span>';b+='<span class="open_folder" title="Ordner mit Datei anzeigen">'+d.name+"</span>";b+="</li>"});b+="</ul>";$("div.main_files").html(b);$("ul.freigaben").tooltip();$("ul.freigaben span.show_link").unbind("click").click(function(){var a=
$(this).parent().children("a").attr("href");j_alert('Die Datei wurde freigegeben.<br /><br /><input readonly="readonly" onclick="this.focus();this.select();" style="border:1px solid black; background-color:gray; text:white; width:100%;" value="'+a+'"><br /><br />Unter "Freigabe" sehen Sie alle Freigaben und k\u00f6nnen diese l\u00f6schen!')});$("ul.freigaben span.del_link").unbind("click").click(function(){var a=$(this).parent().attr("fid");$.post(add_daten.siteurl+"/ajax.php?addon=daten",{todo:"freigabedel",
id:a}).always(function(a){null!=a&&null!=a.main&&a.main.okay?(j_alert("Die Freigabe wurde gel\u00f6scht!"),show_freigaben()):j_alert("Die Freigabe konnte nicht gel\u00f6scht werden!")})});$("ul.freigaben span.open_folder").unbind("click").click(function(){var a=$(this).parent().attr("path");allgvars.folder="user";allgvars.path=a.replace(/\\/g,"/").replace(/\/[^\/]*\/?$/,"")+"/";main_explorer()})}else show_error("404","Keine Freigaben gefunden!","div.main_files")})}var anzahl,touchbar_status=!0;
function shall_do_fileload(){return touchbar_status}function trigger_touchbedienung(a,b,c){if(1==anzahl)if(anzahl++,0==a)$(b).trigger("contextmenu");else if(1==a)$(b).trigger("dblclick");else if(2==a)a=$.Event("keyup"),a.keyCode=c,$(b).trigger(a);else return!1;else return!1}
$(function(){if("ontouchstart"in window||0<navigator.msMaxTouchPoints){var a;a='<div style="position:fixed; bottom:0; right:30px; z-index:999999; min-width:410px; max-width:100%; min-height:30px; background-color:black; padding:10px; border-top-left-radius:5px; border-top-right-radius:5px;"><span id="touchbed_butt"><input type="radio" id="alt" name="butt">';a+='<label for="alt">Alt</label>';a+='<input type="radio" id="strg" name="butt">';a+='<label for="strg">Strg</label>';a+='<input type="radio" id="enter" name="butt">';
a+='<label for="enter">Enter</label>';a+='<input type="radio" id="dopp" name="butt">';a+='<label for="dopp">Doppelklick</label>';a+='<input type="radio" id="rec" name="butt">';a+='<label for="rec">Rechtsklick</label>';a+="</span>";a+='<span id="touchbed_clo" title="Schlie\u00dfen">&darr;</span>';a+='<br /><small style="color:white;">Button und dann Stelle f\u00fcr den Befehl anklicken</small>';a+="</div>";$("body").append(a);$("#touchbed_butt").buttonset();$("#touchbed_clo").button();$("#touchbed_clo").tooltip();
$("#touchbed_butt input[type=radio]").unbind("click").click(function(){var a=$(this).attr("id");anzahl=1;touchbar_status=!1;$("#touchbed_butt").buttonset("disable");$("td.edit").unbind("click").click(function(){var c;"alt"==a?(c=$(this).children("textarea"),trigger_touchbedienung(2,c,18)):"strg"==a?(c=$(this).children("textarea"),trigger_touchbedienung(2,c,17)):"dopp"==a?trigger_touchbedienung(1,this):"rec"==a&&trigger_touchbedienung(0,this);$("#touchbed_butt").buttonset("enable");touchbar_status=
!0});$("#new_name").unbind("click").click(function(){"strg"==a?trigger_touchbedienung(2,this,17):"enter"==a&&trigger_touchbedienung(2,this,13);$("#touchbed_butt").buttonset("enable");touchbar_status=!0});$("ul.files li").click(function(c){"rec"==a&&trigger_touchbedienung(0,this);$("#touchbed_butt").buttonset("enable");touchbar_status=!0});$(".pathbar").unbind("click").click(function(){if("enter"==a){var c=$(this).children("input");trigger_touchbedienung(2,c,13)}else"dopp"==a&&trigger_touchbedienung(1,
this);$("#touchbed_butt").buttonset("enable");touchbar_status=!0})});$("#touchbed_clo").click(function(){$(this).parent().hide("blur")})}});
