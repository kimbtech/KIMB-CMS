function make_ergeb(){$(structur.aus).css("display","block");ajaxrequest({},draw_stat);function logit(data){$(structur.aus).html('<pre>'+JSON.stringify(data,null,2)+'</pre>')}
var html='<div id="graphnav"></div>'+'<div id="graphareagroup">'+'<div id="grapharea"></div>'+'<canvas id="auswertchart" style="width:100%;"></canvas>'+'<div id="freitextarea"></div>'+'</div>';$(structur.aus).html(html);structur.ausnav=structur.aus+" div#graphnav";structur.ausgrag=structur.aus+" div#graphareagroup";structur.ausgra=structur.ausgrag+" div#grapharea";structur.canv=structur.ausgrag+" canvas#auswertchart";structur.ausfrt=structur.ausgrag+" div#freitextarea";function draw_stat(ergeb){ergeb=ergeb.ergebnisse;if(typeof ergeb=="undefined"){errormessage("Es sind noch keine Ergebnisse vorhanden!");$(structur.ausnav).html("<h3>Es sind noch keine Ergebnisse vorhanden!</h3>");return !1}
var html='<button class="grafrabutts" fra="0">Übersicht</button>';$.each(ergeb.data,function(k,v){html+='<button class="grafrabutts" fra="'+k+'">Frage '+k+'</button>'});html+='<br /><br />';$(structur.ausnav).html(html);$("button.grafrabutts[fra=0]")[0].disabled=!0;make_uebersicht();$("button.grafrabutts").click(function(){var fra=$(this).attr("fra");$("button.grafrabutts").each(function(){$(this)[0].disabled=!1});$("button.grafrabutts[fra="+fra+"]")[0].disabled=!0;if(fra=="0"){make_uebersicht()}
else{make_graph(fra)}});var graph=null;if(ergeb.auswertungstyp=='na'){var teiln=ergeb.teilnehmerliste};function make_graph(id){var thiserg=ergeb.data[id];var html='<h2>Frage '+id+'</h2>';html+='<button id="makejsonexp" style="float:right;">JSON Export (Frage '+id+')</button>';html+='<h4>Fragestellung</h4>';html+='<div><p>'+thiserg.text+'</p></div>';html+='<h4>Antworten</h4>';$(structur.ausgra).html(html);$("button#makejsonexp").click(function(){var exportd=thiserg;if(ergeb.auswertungstyp=='na'){exportd.teilnehmerliste=ergeb.teilnehmerliste};dataexport(exportd)});var colorindex='leer';function makecolor(rand){var color=['#FAA43A','#F17CB0','#5DA5DA','#4D4D4D','#B276B2','#60BD68','#F15854','#B2912F','#DECF3F'];if((typeof rand!=="undefined"&&rand)||colorindex=='leer'){colorindex=Math.floor(Math.random()*(color.length+1))}
colorindex++;if(colorindex>color.length){colorindex=0}
return color[colorindex]}
var c={type:'',labels:[],label:[],data:[],bgcolor:[],bocolor:[],options:{},use:!0};if(thiserg.type=='au'){c.type='pie';if(ergeb.auswertungstyp=='na'){c.options.tooltips={callbacks:{footer:maketooltiptext}};var namesarray=[];$.each(thiserg.ergebnisse,function(feld,user){var us=[];if(typeof user=="object"){$.each(user,function(key,userid){us.push(teiln[userid])})}
namesarray.push(us)});function maketooltiptext(place,data){var labelid=place[0].index;return namesarray[labelid]}}
c.bocolor=makecolor(!0);$.each(thiserg.ergebnisse,function(k,v){c.labels.push(k);if(ergeb.auswertungstyp=='na'){if(typeof v=="object"){c.data.push(v.length)}
else{c.data.push(0)}}
else{c.data.push(v)}
c.bgcolor.push(makecolor())});var graok=!0}
else if(thiserg.type=='mc'||thiserg.type=='za'){if(thiserg.type=='za'){c.type='horizontalBar';c.options={scales:{xAxes:[{ticks:{stepSize:1,beginAtZero:!0}}]},legend:{display:!1}}}
else{c.type='bar';c.options={scales:{yAxes:[{ticks:{stepSize:1,beginAtZero:!0}}]},legend:{display:!1}}}
if(ergeb.auswertungstyp=='na'){c.options.tooltips={callbacks:{footer:maketooltiptext}};var namesarray=[];$.each(thiserg.ergebnisse,function(feld,user){var us=[];if(typeof user=="object"){$.each(user,function(key,userid){us.push(teiln[userid])})}
namesarray.push(us)});function maketooltiptext(place,data){var labelid=place[0].index;return namesarray[labelid]}}
c.bgcolor=makecolor(!0);c.label='Anzahl';$.each(thiserg.ergebnisse,function(k,v){c.labels.push(k);if(ergeb.auswertungstyp=='na'){if(typeof v=="object"){c.data.push(v.length)}
else{c.data.push(0)}}
else{c.data.push(v)}
c.bocolor.push(makecolor())});var graok=!0}
else if(thiserg.type=='ab'){c.type='bar';c.options={scales:{yAxes:[{ticks:{stepSize:1,beginAtZero:!0}}]}};c.use=!1;if(ergeb.auswertungstyp=='na'){c.options.tooltips={callbacks:{footer:maketooltiptext}};var namesarray=[];$.each(thiserg.ergebnisse,function(feld,val){var add=[];$.each(val,function(id,user){var us=[];if(typeof user=="object"){$.each(user,function(key,userid){us.push(teiln[userid])})}
add.push(us)});namesarray.push(add)});function maketooltiptext(place,data){var labelid=place[0].index;var dataindex=place[0].datasetIndex;return namesarray[dataindex][labelid]}}
var datasethere={labels:['Sehr gut','Gut','Befriedigend','Ausreichend','Mangelhaft','Ungenügend','Keine Angabe'],datasets:[]};$.each(thiserg.ergebnisse,function(k,v){var set={data:[],label:k,backgroundColor:makecolor(),borderColor:makecolor(),borderWidth:2};$.each(v,function(kk,vv){if(ergeb.auswertungstyp=='na'){if(typeof vv=="object"){set.data.push(vv.length)}
else{set.data.push(0)}}
else{set.data.push(vv)}});datasethere.datasets.push(set)});var graok=!0}
else{$(structur.ausfrt).css('display','block');var html='<h5>Übersicht</h5>'+'<ul>'+'<li><b>Gesamtzahl der Teilnehmer:</b> '+ergeb.teilnehmeranzahl+'</li>'+'<li><b>Gesamtzahl der Texte:</b> '+thiserg.ergebnisse.anzahl+'</li>'+'<li><b>Anteil Texte:</b> '+Math.round((thiserg.ergebnisse.anzahl/ergeb.teilnehmeranzahl)*100)+'%</li>'+'</ul>';html+='<h5>Texte</h5>';html+='<table id="textetable">';$.each(thiserg.ergebnisse.texte,function(k,v){var name=((ergeb.auswertungstyp=='na')?teiln[k]:k);html+='<tr>';html+='<td class="first">'+name+'</td>';html+='<td><div>'+v.replace(/(\r\n)|(\r)|(\n)/g,'<br />\r\n')+'</div></td>';html+='</tr>'});html+='</table>';$(structur.ausfrt).html(html);$("table#textetable, table#textetable td").css({'width':'100%','border':'1px solid black','border-collapse':'collapse','padding':'5px'});$("table#textetable td.first").css({'width':'20%','min-width':'100px'});$("table#textetable td div").css({'background-color':'grey','margin':'5px','padding':'5px','border-radius':'5px'});var graok=!1}
if(graok){if(c.use){var datasets={labels:c.labels,datasets:[{data:c.data,label:c.label,backgroundColor:c.bgcolor,borderColor:c.bocolor,borderWidth:2}]}}
else{var datasets=datasethere}
$(structur.ausfrt).css('display','none');$(structur.canv).css('display','block');if(graph!==null){graph.destroy()}
graph=new Chart($(structur.canv)[0],{type:c.type,data:datasets,options:c.options})}
else{$(structur.canv).css('display','none')}}
function make_uebersicht(){var html='<h2>Übersicht</h2>';html+='<table id="uebertable">';html+='<tr>';html+='<th>Teilnehmer</th>';html+='<td>'+ergeb.teilnehmeranzahl+'</td>';html+='</tr>';if(ergeb.auswertungstyp=='na'){html+='<tr>';html+='<td colspan="2"><ul>';$.each(ergeb.teilnehmerliste,function(k,v){html+='<li>'+v+'</li>'});html+='</ul></td>';html+='</tr>'}
html+='<tr>';html+='<th>Fragen</th>';html+='<td>'+ergeb.fragenanzahl+'</td>';html+='</tr>';html+='<tr>';html+='<th>Typ</th>';html+='<td>'+(ergeb.auswertungstyp=='na'?'Name':'Anonym')+'</td>';html+='</tr>';html+='</table>';html+='<button id="makejsonexp">JSON Export (alles)</button>';$(structur.ausgra).html(html);$("table#uebertable, table#uebertable td, table#uebertable th").css({'width':'100%','max-width':'500px','border':'1px solid black','border-collapse':'collapse','padding':'5px'});$(structur.canv).css('display','none');$(structur.ausfrt).css('display','none');$("button#makejsonexp").click(function(){dataexport(ergeb)})}
function dataexport(data){$("body").append('<div id="mainexportbox">'+'<div style="position:fixed; top:0; left:0; background-color:black; opacity:0.6; width:100%; height:100%;"></div>'+'<div style="position:absolute; top:5px; border-radius:5px; left:calc(50% - 300px); background-color:#5d7; padding:5px; width:600px;">'+'<div><button style="width:100%;">Schließen</button></div>'+'<div class="inner">'+'<pre>'+'<code class="language-json">'+JSON.stringify(data,null,2)+'</code>'+'</pre>'+'</div>'+'<div><button style="width:100%;">Schließen</button></div>'+'</div>'+'</div>');Prism.highlightAll();$("div#mainexportbox div button").click(function(){$("div#mainexportbox").remove()})}}}